summary: Go FDO Client E2E Tests
discover:
    how: fmf
execute:
    how: tmt
prepare:
    - how: shell
      script: |
        set -xeo pipefail
        rpm -q --whatprovides 'dnf-command(copr)' &> /dev/null || dnf install -y 'dnf-command(copr)'
        dnf copr list | grep 'fedora-iot/fedora-iot' || {
          . /etc/os-release
          if [ "${ID}" = "centos" ]; then
            dnf copr enable -y '@fedora-iot/fedora-iot' ${ID}-stream-${ID_VERSION}
          else
            dnf copr enable -y '@fedora-iot/fedora-iot'
          fi
        }
        sudo dnf install -y sqlite
        # testing-farm-tag-repository is causing problems with builds see:
        #Â https://docs.testing-farm.io/Testing%20Farm/0.1/test-environment.html#disabling-tag-repository
        dnf install -y --disablerepo=* --enablerepo=copr:copr.fedorainfracloud.org:group_fedora-iot:fedora-iot \
          go-fdo-server \
          go-fdo-server-manufacturer \
          go-fdo-server-owner \
          go-fdo-server-rendezvous
        dnf copr disable -y @fedora-iot/fedora-iot
provision:
    how: virtual
    memory: 4096
    disk: 30
